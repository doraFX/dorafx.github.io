<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
		<title>企企兔模拟器</title>
		<link rel="shortcut icon" href="logo.png">
		<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
		<script>
			LA.init({
				id: "Jl5bi3TeBeipiIT3",
				ck: "Jl5bi3TeBeipiIT3",
				autoTrack: true,
				hashMode: true,
				screenRecord: true
			})
		</script>
		<script>
			window.si = window.si || function() {
				(window.siq = window.siq || []).push(arguments);
			};
		</script>
		<script defer src="/_vercel/speed-insights/script.js"></script>
		<script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "https://hm.baidu.com/hm.js?8730c7bd77352ff16d63e2d493255930";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>
		<!-- Google tag (gtag.js) -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=G-4N6X53WMGZ"></script>
		<script>
			window.dataLayer = window.dataLayer || [];

			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());

			gtag('config', 'G-4N6X53WMGZ');
		</script>

		<style>
			html,
			body {
				height: 100%;
				margin: 0;
				background: #e5e5e5;
				overflow: hidden;
			}

			.stage {
				min-height: 100%;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 16px;
				box-sizing: border-box;
			}

			/* 外壳：由 JS 写入真实占位尺寸，防漂移 */
			#watchWrap {
				width: 560px;
				height: 870px;
			}

			/* 手表主体（设计尺寸） */
			#watch {
				width: 560px;
				height: 870px;
				position: relative;
				transform-origin: top left;
				transform: scale(1);
			}

			/* app：屏幕区域 */
			#app {
				position: absolute;
				left: 47px;
				/* x */
				top: 183px;
				/* y */
				width: 432px;
				height: 514px;
				border-radius: 100px;
				z-index: 1;
				background: #000000;
				/* 改为黑色背景，模拟屏幕 */
				overflow: hidden;
				/* 为了居中 loading */
				display: flex;
				align-items: center;
				justify-content: center;
			}

			/* iframe：初始透明，通过 opacity 渐变 */
			#app iframe {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				border: none;
				opacity: 0;
				/* 初始隐藏 */
				transition: opacity 250ms ease-in-out;
				/* 250ms 渐显 */
				z-index: 10;
				/* 确保在 loading 之上 */
			}

			/* CSS Loading 转圈 */
			.loading-spinner {
				width: 40px;
				height: 40px;
				border: 4px solid rgba(255, 255, 255, 0.2);
				border-top: 4px solid #ffffff;
				border-radius: 50%;
				animation: spin 1s linear infinite;
				z-index: 5;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}

				100% {
					transform: rotate(360deg);
				}
			}

			/* watch.png：在最上层 */
			#watchImg {
				position: absolute;
				inset: 0;
				width: 100%;
				height: 100%;
				object-fit: contain;
				pointer-events: none;
				user-select: none;
				-webkit-user-drag: none;
				z-index: 2;
			}
		</style>
	</head>

	<body>
		<div class="stage" id="stage">
			<div id="watchWrap">
				<div id="watch">
					<div id="app">
						<!-- Loading 动画 -->
						<div class="loading-spinner" id="loading"></div>
						<!-- iframe -->
						<iframe id="appFrame" src="101.html" frameborder="0"></iframe>
					</div>
					<img id="watchImg" src="../common/watch.webp" alt="watch" />
				</div>
			</div>
		</div>

		<script>
			(function() {
				// --- 1. 模拟器缩放逻辑 ---
				const stage = document.getElementById("stage");
				const wrap = document.getElementById("watchWrap");
				const watch = document.getElementById("watch");
				const BASE_W = 560;
				const BASE_H = 870;
				const K = 0.75;

				function getViewportWH() {
					const vv = window.visualViewport;
					const vw = vv ? vv.width : window.innerWidth;
					const vh = vv ? vv.height : window.innerHeight;
					return {
						vw,
						vh
					};
				}

				function getStagePadding() {
					const cs = getComputedStyle(stage);
					const px = (v) => parseFloat(v) || 0;
					const padX = px(cs.paddingLeft) + px(cs.paddingRight);
					const padY = px(cs.paddingTop) + px(cs.paddingBottom);
					return {
						padX,
						padY
					};
				}

				function applyScale() {
					const {
						vw,
						vh
					} = getViewportWH();
					const {
						padX,
						padY
					} = getStagePadding();
					const availW = Math.max(0, vw - padX);
					const availH = Math.max(0, vh - padY);

					let s = 1;
					if (availW < BASE_W || availH < BASE_H) {
						s = Math.min(availW / BASE_W, availH / BASE_H);
					}
					const finalScale = Math.max(0.05, s * K);

					wrap.style.width = (BASE_W * finalScale) + "px";
					wrap.style.height = (BASE_H * finalScale) + "px";
					watch.style.transform = `scale(${finalScale})`;
				}

				window.addEventListener("resize", applyScale);
				window.addEventListener("orientationchange", applyScale);
				if (window.visualViewport) {
					window.visualViewport.addEventListener("resize", applyScale);
					window.visualViewport.addEventListener("scroll", applyScale);
				}
				const img = document.getElementById("watchImg");
				img.addEventListener("load", applyScale);
				applyScale();


				// --- 2. iframe Loading 逻辑 ---
				const iframe = document.getElementById('appFrame');
				const loading = document.getElementById('loading');

				// 监听 iframe 加载完成事件
				iframe.addEventListener('load', function() {
					// 显示 iframe (opacity 0 -> 1)
					iframe.style.opacity = '1';

					// 延迟一点点移除 loading，确保渐变平滑
					setTimeout(() => {
						if (loading) loading.style.display = 'none';
					}, 250);
				});

			})();
		</script>
	</body>
</html>