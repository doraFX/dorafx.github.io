<!DOCTYPE html>
<html lang="en" class="no-js">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>DoraFX Presents</title>
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link rel="shortcut icon" href="images/logo.ico">
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" /> <!-- Materialdesign icon Css-->
		<link rel="stylesheet" type="text/css" href="css/icofont.min.css" /> <!-- Pe 7 icon Css-->
		<link rel="stylesheet" type="text/css" href="css/pe-icon-7-stroke.css" /> <!-- Custom Css -->
		<link rel="stylesheet" type="text/css" href="css/style.css" />
		<link rel="stylesheet" type="text/css" href="css/all.css" />
		<script src="js/jquery-2.2.4.min.js"></script>

		<script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
		<script>
			window.si = window.si || function() {
				(window.siq = window.siq || []).push(arguments);
			};
		</script>
		<script defer src="/_vercel/speed-insights/script.js"></script>
		<script>
			LA.init({
				id: "Jl5bi3TeBeipiIT3",
				ck: "Jl5bi3TeBeipiIT3",
				autoTrack: true
			})
		</script>
		<script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "https://hm.baidu.com/hm.js?8730c7bd77352ff16d63e2d493255930";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>

		<script>
			$(document).ready(function() {
				// 定义开关变量和最大显示数量
				// 当 limitSwitch = 1 时，仅显示 maxItems 个作品；当 limitSwitch = 0 时，显示全部作品
				let limitSwitch = 0; // 1 开启限制，0 关闭限制
				let maxItems = 20; // 当开启限制时，仅显示 20 个作品

				// 全局保存 JSON 数据，后续点击时可直接查找对应作品信息
				let portfolioData = [];

				/**
				 * 加载 JSON 数据并生成作品卡片
				 * 数据从 js/portfolio.json 加载后先按 id 降序排序，
				 * 再将推荐项目和非推荐项目分别筛选后，推荐项目排在前面。
				 * 生成的卡片 HTML 格式如下：
				 *
				 * 推荐项目：
				 * <div class="col-lg-4 {category} recommended personal" id="workid{ID}" style="position: relative; left: 0px; top: 0px;">
				 *   <a class="portfolio-link">
				 *     <div class="portfolio-box">
				 *       <div class="portfolio-box-img">
				 *         <img src="{cover}" class="img-fluid" alt="member-image">
				 *       </div>
				 *       <div class="portfolio-box-detail">
				 *         <p>{category}</p>
				 *         <h4>{title}</h4>
				 *       </div>
				 *     </div>
				 *   </a>
				 *   <div class="recommend">
				 *     <div class="recommend-inner">
				 *       <div class="recommend-inner-icon">
				 *         <img src="images/recommend.svg" alt="">
				 *       </div>
				 *       <div class="recommend-text">Recommended</div>
				 *     </div>
				 *   </div>
				 * </div>
				 *
				 * 非推荐项目（不含后面的 <div class="recommend"> 块）。
				 */
				function loadPortfolio() {
					$.getJSON("js/portfolio.json", function(data) {
							// 保存数据到全局变量
							portfolioData = data;

							// 按 id 降序排序（id 较大排在前面）
							const sortedData = data.slice().sort(function(a, b) {
								return b.id - a.id;
							});

							// 筛选推荐和非推荐项目
							let recommendedItems = sortedData.filter(item => item.recommend === true);
							let nonRecommendedItems = sortedData.filter(item => !item.recommend);

							// 合并时推荐项目放在前面
							let mergedItems = recommendedItems.concat(nonRecommendedItems);

							// 根据 limitSwitch 判断是否限制显示作品数量
							let itemsToShow = (limitSwitch === 1) ? mergedItems.slice(0, maxItems) : mergedItems;

							// 遍历每个作品，生成 HTML 卡片
							itemsToShow.forEach(function(item) {
								// 计算外层 div 的 class
								// 始终包含 personal 与 category，如果推荐则再加 recommended
								let classes = item.category + " personal";
								if (item.recommend) {
									classes += " recommended";
								}

								// 处理封面图片：若 media.poster 有值则使用，否则使用默认图片
								let cover = "images/default.webp";
								if (item.media && item.media.poster && item.media.poster.trim() !== "") {
									cover = item.media.poster;
								}

								// 生成作品卡片 HTML
								let cardHTML =
									`<div class="col-lg-4 ${classes}" id="workid${item.id}" style="position: relative; left: 0px; top: 0px;">`;
								cardHTML += `<a class="portfolio-link">`;
								cardHTML += `<div class="portfolio-box">`;
								cardHTML += `<div class="portfolio-box-img">`;
								cardHTML += `<img src="${cover}" class="img-fluid" alt="member-image">`;
								cardHTML += `</div>`;
								cardHTML += `<div class="portfolio-box-detail">`;
								cardHTML += `<p>${item.category}</p>`;
								cardHTML += `<h4>${item.title}</h4>`;
								cardHTML += `</div>`;
								cardHTML += `</div>`;
								cardHTML += `</a>`;
								// 如果为推荐项目，则添加额外的推荐标识块
								if (item.recommend) {
									cardHTML += `<div class="recommend">`;
									cardHTML += `<div class="recommend-inner">`;
									cardHTML += `<div class="recommend-inner-icon">`;
									cardHTML += `<img src="images/recommend.svg" alt="">`;
									cardHTML += `</div>`;
									cardHTML += `<div class="recommend-text">Recommended</div>`;
									cardHTML += `</div>`;
									cardHTML += `</div>`;
								}
								cardHTML += `</div>`;

								// 将生成的卡片追加到 #addplace 容器中
								$("#addplace").append(cardHTML);
							});
						})
						.fail(function() {
							console.error("Error loading portfolio JSON");
						});
				}

				// 调用加载函数
				loadPortfolio();

				/**
				 * 为作品卡片绑定点击事件
				 * 点击时直接从所在元素的 id 属性（格式 "workidXX"）中提取作品 id，
				 * 然后调用 openWork(id) 根据 JSON 数据填充统一的弹出层。
				 */
				$("#addplace").on("click", ".portfolio-link", function() {
					// 获取最近父元素的 id，例如 "workid36"
					let parentId = $(this).closest("div[id^='workid']").attr("id");
					// 去掉 "workid" 前缀，得到作品 id
					let id = parentId.replace("workid", "");
					openWork(id);
				});

				/**
				 * 打开统一弹出层，填充作品详细信息
				 * 根据作品 id 从 portfolioData 中查找对应记录，
				 * 将 title 填充到 .single-linksource-h，
				 * 将 description 填充到 .single-linksource-p，
				 * 将 links 数组依次填充到 btnlink1~btnlink4（有多少链接显示多少按钮），
				 * 如果媒体类型为 video，则显示视频预览区域，并设置视频元素 (#SVideo2) 的 src 与 poster。
				 */
				function openWork(id) {
					// 查找作品记录（注意数值转换）
					let work = portfolioData.find(item => Number(item.id) === Number(id));
					if (!work) {
						console.error("Work with id " + id + " not found.");
						return;
					}

					// 显示统一弹出层（这里保持使用 .single-linksource 类）
					$(".single-linksource").show();

					// 填充标题和描述
					$(".single-linksource-h").html(work.title);
					$(".single-linksource-p").html(work.description);

					// 清空所有链接按钮，并隐藏
					$("#btnlink1, #btnlink2, #btnlink3, #btnlink4").hide().html("");

					// 遍历 links 数组，最多填充 4 个按钮
					if (work.links && work.links.length > 0) {
						work.links.forEach(function(link, index) {
							if (index < 4) {
								$("#btnlink" + (index + 1))
									.html(link.name)
									.attr("href", link.url)
									.show();
							}
						});
					}

					// 根据媒体类型处理预览区域
					if (work.media && work.media.type.toLowerCase() === "video") {
						// 如果是视频，显示视频区域
						$("#slvideo").show();
						$("#SlImg").hide();
						$("#SlBlog").hide();
						$("#SVideo2")
							.attr("src", work.media.url)
							.attr("poster", work.media.poster);
						// 如果存在图片预览元素，则移除
					} else if (work.media && work.media.type.toLowerCase() === "image") {
						// 如果是图片，隐藏视频区域
						$("#slvideo").hide();
						$("#SlImg").show();
						$("#SlBlog").hide();
						$("#SImg").attr("src", work.media.url);
					} else if (work.media && work.media.type.toLowerCase() === "blog") {
						// 如果是博文，隐藏视频区域并将内容加载到 #popupMedia
						$("#slvideo").hide();
						$("#SlImg").hide();
						$("#SlBlog").show();
						$("#blogcontent").html(work.content || "");
					} else {
						// 其他情况，清空媒体区域
						$("#slvideo").hide();
						$("#SlImg").hide();
						$("#SlBlog").hide();
					}

				}

				/**
				 * 关闭弹出层函数
				 * 隐藏 .single-linksource 后清空标题、描述、媒体和链接区域
				 */
				function closeBlog() {
					$(".single-linksource").fadeOut(function() {
						$(".single-linksource-h").empty();
						$(".single-linksource-p").empty();
						$("#slvideo").hide();
						$("#SVideo2").attr("src", "").attr("poster", "");
						$("#popupLinks").empty();
					});
				}

				// 暴露关闭函数到全局，方便 HTML 中调用
				window.closeBlog = closeBlog;
			});
		</script>

		<script src="js/portfolio.js"></script>
	</head>
	<body>
		<div id="blogPopup" class="single-linksource" style="display: none;">
			<div onclick="closebuttonlink();" class="closebutton"><i class="fas fa-times"></i></div>
			<div class="single-contain">
				<p class="single-linksource-h"></p>
				<p class="single-linksource-p"></p>
				<div class="single-inner" style="display: none;" id="slvideo">
					<video id="SVideo2" class="single-v" src="" poster="" height="100%" width="100%" data-ckin="default"
						controls="" data-title=""></video>
				</div>
				<div class="single-inner" style="display: none;" id="SlImg">
					<img id="SImg" src="" class="single-img">
				</div>
				<div class="single-inner" style="display: none;" id="SlBlog">
					<div id="blogcontent"></div>
				</div>
				<p class="single-linksource-h6"></p>
				<div class="text-center margin-t-30">
					<a href="" class="btn btn-custom" id="btnlink1"></a>
					<a href="" class="btn btn-custom" id="btnlink2"></a>
					<a href="" class="btn btn-custom" id="btnlink3"></a>
					<a href="" class="btn btn-custom" id="btnlink4"></a>
				</div>
			</div>
		</div>

		<!-- Start Navbar -->
		<nav class="navbar navbar-expand-lg navbar-default navbar-custom navbar-light">
			<div class="container"> <a class="navbar-brand logo" href="index.html"><img src="images/DoraFX.webp"
						class="logo-common"></a>
				<div class="navbar-header"> <button class="navbar-toggler" type="button" data-toggle="collapse"
						data-target="#navbar-collapse-1" aria-controls="navbarSupportedContent" aria-expanded="false"
						aria-label="Toggle navigation"><i class="fas fa-bars"></i></button> </div>
				<div class="collapse navbar-collapse" id="navbar-collapse-1">
					<ul class="nav navbar-nav ml-auto">
						<li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
						<li class="nav-item"><a class="nav-link" onclick="alert(" 待更新");">Resume</a></li>
						<li class="nav-item"><a class="nav-link" href="portfolio.html">Portfolio</a></li>
						<li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
						<li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
					</ul>
				</div>
			</div>
		</nav> <!-- End Navbar -->
		<section>
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="page-title text-center">
							<div class="row justify-content-center">
								<div class="col-lg-9">
									<h2>Welcome!<br>My name is<br><span>宋清鑫 Song Qingxin</span></h2>
									<p class="text-muted">I am a CG artist studying Digital Media Art at Communication
										University of China.<br>
										<a href="https://www.zcool.com.cn/u/17973793">Zcool</a>&emsp;
										<a href="https://www.behance.net/dorafx">Behance</a>&emsp;
										<a href="https://www.ggac.com/user/118772">GGAC</a>
									</p>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<section class="section">
			<div class="container">
				<!-- SECTION FILTER ================================================== -->
				<div class="row">
					<div class="col-lg-12">
						<div class="portfolio-filter text-center">
							<a href="#" data-filter="*" class="current waves-effect waves-success">All</a>
							<a href="#" data-filter=".3D" class="waves-effect waves-success">3D</a>
							<a href="#" data-filter=".2D" class="waves-effect waves-success">2D</a>
							<a href="#" data-filter=".Video" class="waves-effect waves-success">Video</a>
							<a href="#" data-filter=".Web" class="waves-effect waves-success">Web</a>
						</div>
					</div>
				</div>
				<div class="port portfolio-masonry m-b-30">
					<div class="page-title text-center">
						<div class="row justify-content-center">
							<div class="col-lg-9">
								<p class="text-muted">The homepage only displays a maximum of 20 works, please visit <a
										href="portfolio.html">portfolio</a> to view all works.</p>
							</div>
						</div>
					</div>
					<div class="portfolioContainer row" id="addplace">
						<!--在这里添加的作品-->
					</div> <!-- end portfoliocontainer-->
				</div> <!-- End row -->
				<div class="row">
					<div class="col-lg-12">
						<div class="text-center margin-t-30"> <a href="portfolio.html" class="btn btn-custom">More
								works</a>
						</div>
					</div>
				</div>
			</div> <!-- end container -->
		</section>
		<footer class="footer">
			<div class="container">
				<div class="row">
					<div class="col-lg-12">
						<div class="text-center">
							<a class="pb-2 display-4 mb-0 d-inline-block text-dark" href="index.html">
								<img src="images/DoraFX.webp" class="logo-common">
							</a>
							<ul class="list-inline social-circle margin-t-30">
								<li onclick="s1();" class="list-inline-item">
									<a class="social-block">
										<img src="images/social logo/01.svg" id="social01" alt="">
									</a>
								</li>
								<li onclick="s2();" class="list-inline-item">
									<a class="social-block">
										<img src="images/social logo/02.svg" id="social02" alt="">
									</a>
								</li>
								<li onclick="s3();" class="list-inline-item">
									<a class="social-block">
										<img src="images/social logo/03.svg" id="social03" alt="">
									</a>
								</li>
								<li onclick="s4();" class="list-inline-item">
									<a class="social-block wechat-block">
										<img src="images/social logo/04.svg" id="social04" alt="">
									</a>
									<div class="wechat-code">
										<div class="wechat-code-container">
											<img src="images/social logo/wechat.webp" alt="">
										</div>
										<div class="wechat-code-arrow">
											<svg xmlns="http://www.w3.org/2000/svg" width="895.894" height="427.5"
												viewBox="0 0 895.894 427.5">
												<path id="路径_2" data-name="路径 2"
													d="M1139.02,1098a66.675,66.675,0,0,1-26.222-5.359,66.088,66.088,0,0,1-22.705-16.077L735.121,691.757A66.347,66.347,0,0,0,691.074,670.5h895.894a66.339,66.339,0,0,0-44.047,21.257l-354.973,384.807a66.193,66.193,0,0,1-35.6,20.1A67.1,67.1,0,0,1,1139.02,1098Z"
													transform="translate(-691.074 -670.5)" fill="#f6f6f6" />
											</svg>
										</div>
									</div>
								</li>
								<li onclick="s5();" class="list-inline-item">
									<a class="social-block">
										<img src="images/social logo/05.svg" id="social05" alt="">
									</a>
								</li>
							</ul>
							<div class="beian">
								<div class="ICP">
									<a href="https://beian.miit.gov.cn/">京ICP备2023030112号</a>
								</div>
								<div class="gap"></div>
								<div class="Gongan">
									<img src="images/gongan.png" alt="">
									<a
										href="https://beian.mps.gov.cn/#/query/webSearch?code=11010502053879">京公网安备11010502053879号</a>
								</div>
							</div>
							<p class="text-muted m-b-0 copyright-txt" id="copyright"></p>
						</div>
					</div>
				</div> <!-- end row -->
			</div>
		</footer> <!-- END FOOTER -->
		<!-- JAVASCRIPTS -->
		<script src="js/bootstrap.min.js"></script> <!-- isotope filter plugin -->
		<script src="js/isotope.pkgd.min.js"></script>
		<script src="js/portfolio-filter.js"></script>
		<script src="js/app.js"></script>
		<script src="js/social.js"></script>
		<script type="text/javascript">
			var date = new Date();
			var year = date.getFullYear();
			copyright = " © " + year + " DoraFX";
			$("#copyright").html(copyright);
		</script>
	</body>
</html>