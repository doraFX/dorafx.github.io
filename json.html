<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>多语言 JSON 编辑器</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<style>
			* {
				box-sizing: border-box;
			}

			body {
				font-family: system-ui, -apple-system, sans-serif;
			}

			.lang-panel {
				min-width: 0;
			}

			textarea:focus,
			input:focus {
				outline: none;
				box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
			}

			.field-row:hover {
				background-color: #f8fafc;
			}

			::-webkit-scrollbar {
				width: 6px;
				height: 6px;
			}

			::-webkit-scrollbar-track {
				background: #f1f5f9;
			}

			::-webkit-scrollbar-thumb {
				background: #cbd5e1;
				border-radius: 3px;
			}

			.tree-item {
				cursor: pointer;
				user-select: none;
			}

			.tree-item:hover {
				background-color: #f1f5f9;
			}

			.field-complete {
				background-color: #dcfce7;
			}

			.field-partial {
				background-color: #fef3c7;
			}

			.field-missing {
				background-color: #fee2e2;
			}

			.toggle-btn {
				transition: all 0.2s;
			}

			.toggle-btn.active {
				background-color: #3b82f6;
				color: white;
			}

			.array-index {
				background-color: #dbeafe;
				color: #1e40af;
				font-weight: 500;
			}

			/* 开关样式 */
			.switch {
				position: relative;
				display: inline-block;
				width: 44px;
				height: 24px;
			}

			.switch input {
				opacity: 0;
				width: 0;
				height: 0;
			}

			.slider {
				position: absolute;
				cursor: pointer;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: #cbd5e1;
				transition: .3s;
				border-radius: 24px;
			}

			.slider:before {
				position: absolute;
				content: "";
				height: 18px;
				width: 18px;
				left: 3px;
				bottom: 3px;
				background-color: white;
				transition: .3s;
				border-radius: 50%;
			}

			input:checked+.slider {
				background-color: #22c55e;
			}

			input:checked+.slider:before {
				transform: translateX(20px);
			}
		</style>
	</head>
	<body class="bg-slate-100 min-h-screen">
		<div class="p-4 max-w-full mx-auto">
			<!-- Header -->
			<div class="bg-white rounded-lg shadow-sm p-4 mb-4">
				<div class="flex items-center justify-between mb-4">
					<h1 class="text-xl font-bold text-slate-800">多语言 JSON 编辑器</h1>
					<div class="flex gap-2">
						<button onclick="copyToClipboard()"
							class="px-3 py-1.5 bg-slate-600 text-white text-sm rounded hover:bg-slate-700 transition">
							复制 JSON
						</button>
						<button onclick="downloadJSON()"
							class="px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition">
							下载 JSON
						</button>
					</div>
				</div>

				<!-- Input Area -->
				<div class="mb-4">
					<label class="block text-sm font-medium text-slate-700 mb-1">粘贴 JSON 数据</label>
					<textarea id="jsonInput"
						class="w-full h-32 p-3 border border-slate-300 rounded-lg text-sm font-mono resize-none"
						placeholder='粘贴 JSON 数据，支持标准 JSON 或 translations = {...} 格式'></textarea>
					<button onclick="parseJSON()"
						class="mt-2 px-4 py-2 bg-emerald-600 text-white text-sm rounded hover:bg-emerald-700 transition">
						解析 JSON
					</button>
				</div>

				<!-- Search -->
				<div id="searchBox" class="hidden">
					<input type="text" id="searchInput"
						class="w-full max-w-md px-3 py-2 border border-slate-300 rounded-lg text-sm"
						placeholder="搜索字段名或值..." oninput="filterFields()">
				</div>
			</div>

			<!-- 左侧字段树 + 右侧编辑面板 -->
			<div id="editorContainer" class="hidden">
				<div class="flex gap-4">
					<!-- 左侧字段树 -->
					<div id="fieldTree" class="w-72 flex-shrink-0 bg-white rounded-lg shadow-sm overflow-hidden"
						style="max-height: calc(100vh - 280px);">
						<div
							class="bg-slate-700 text-white px-4 py-2 font-medium text-sm sticky top-0 flex justify-between items-center">
							<span>字段列表</span>
							<button onclick="showAddFieldModal()"
								class="px-2 py-0.5 bg-emerald-600 text-white text-xs rounded hover:bg-emerald-700">+
								添加</button>
						</div>
						<!-- 图例 -->
						<div class="px-3 py-2 border-b border-slate-200 text-xs flex gap-3">
							<span class="flex items-center gap-1"><span
									class="w-3 h-3 rounded bg-green-200"></span>全部</span>
							<span class="flex items-center gap-1"><span
									class="w-3 h-3 rounded bg-yellow-200"></span>部分</span>
							<span class="flex items-center gap-1"><span
									class="w-3 h-3 rounded bg-red-200"></span>缺失</span>
						</div>
						<div id="treeContent" class="overflow-y-auto" style="max-height: calc(100vh - 360px);"></div>
					</div>

					<!-- 右侧编辑面板 -->
					<div class="flex-1">
						<div id="panels" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4"></div>
					</div>
				</div>
			</div>

			<!-- 添加字段弹窗 -->
			<div id="addFieldModal"
				class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
				<div class="bg-white rounded-lg p-6 w-96 shadow-xl">
					<h3 class="text-lg font-bold mb-4">添加新字段</h3>
					<input type="text" id="newFieldName" class="w-full px-3 py-2 border border-slate-300 rounded mb-4"
						placeholder="字段名 (如: common.newKey 或 apps.applist[0].name)">
					<div class="flex justify-end gap-2">
						<button onclick="hideAddFieldModal()"
							class="px-4 py-2 bg-slate-200 rounded hover:bg-slate-300">取消</button>
						<button onclick="addNewField()"
							class="px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700">添加</button>
					</div>
				</div>
			</div>

			<!-- 原样预览和输出区域 -->
			<div id="previewContainer" class="hidden mt-4">
				<div class="bg-white rounded-lg shadow-sm p-4">
					<div class="flex items-center justify-between mb-3">
						<h2 class="text-lg font-bold text-slate-800">原样预览输出</h2>
						<div class="flex items-center gap-4">
							<!-- 添加引号切换按钮 -->
							<div class="flex items-center gap-2 text-sm">
								<span class="text-slate-600">键名引号:</span>
								<div class="flex rounded overflow-hidden border border-slate-300">
									<button id="quoteOff" onclick="setQuoteMode(false)"
										class="toggle-btn px-3 py-1 text-xs active">无引号</button>
									<button id="quoteOn" onclick="setQuoteMode(true)"
										class="toggle-btn px-3 py-1 text-xs border-l border-slate-300">有引号</button>
								</div>
							</div>
							<div class="flex gap-2">
								<button onclick="copyPreview()"
									class="px-3 py-1.5 bg-slate-600 text-white text-sm rounded hover:bg-slate-700 transition">
									复制
								</button>
								<button onclick="downloadPreview()"
									class="px-3 py-1.5 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 transition">
									下载
								</button>
							</div>
						</div>
					</div>
					<pre id="previewOutput"
						class="w-full p-4 bg-slate-900 text-slate-100 text-sm font-mono rounded-lg overflow-auto max-h-96 whitespace-pre-wrap"></pre>
				</div>
			</div>

			<!-- Empty State -->
			<div id="emptyState" class="bg-white rounded-lg shadow-sm p-12 text-center">
				<div class="text-slate-400 text-6xl mb-4">{ }</div>
				<p class="text-slate-500">粘贴 JSON 数据并点击解析按钮开始编辑</p>
			</div>
		</div>

		<script>
			let translations = {};
			let allKeys = [];
			let originalFormat = 'json';
			let useQuotes = false;
			let isSyncingScroll = false;

			function jsObjectToJSON(str) {
				let result = str;
				// 移除注释
				result = result.replace(/\/\/.*$/gm, '');
				result = result.replace(/\/\*[\s\S]*?\*\//g, '');
				// 给无引号的键名加引号 - 只匹配没有引号的键名
				result = result.replace(/([{,\[]\s*)([a-zA-Z_][a-zA-Z0-9_]*)\s*:/g, '$1"$2":');
				// 单引号转双引号
				result = result.replace(/'([^'\\]*(\\.[^'\\]*)*)'/g, '"$1"');
				// 移除尾随逗号
				result = result.replace(/,(\s*[}\]])/g, '$1');
				return result;
			}

			function parseJSON() {
				const input = document.getElementById('jsonInput').value.trim();
				if (!input) {
					alert('请先粘贴 JSON 数据');
					return;
				}

				try {
					let data;
					let jsonStr = input;

					if (jsonStr.match(/^(const|let|var)?\s*translations\s*=/)) {
						originalFormat = 'js';
					} else {
						originalFormat = 'json';
					}

					jsonStr = jsonStr.replace(/^(const|let|var)?\s*translations\s*=\s*/, '').replace(/;?\s*$/, '');

					try {
						data = JSON.parse(jsonStr);
					} catch (e) {
						const convertedStr = jsObjectToJSON(jsonStr);
						data = JSON.parse(convertedStr);
					}

					translations = data;
					allKeys = getAllKeys(data);
					renderFieldTree();
					renderPanels();
					updatePreview();

					document.getElementById('editorContainer').classList.remove('hidden');
					document.getElementById('searchBox').classList.remove('hidden');
					document.getElementById('previewContainer').classList.remove('hidden');
					document.getElementById('emptyState').classList.add('hidden');
				} catch (e) {
					alert('JSON 解析失败: ' + e.message);
				}
			}

			// 完全重写的键收集函数，正确处理数组
			function getAllKeys(data) {
				const keysArray = [];
				const keysSet = new Set();

				// 遍历所有语言，收集所有可能的键
				Object.values(data).forEach(langData => {
					if (typeof langData === 'object' && langData !== null) {
						collectKeysRecursive(langData, '', keysArray, keysSet);
					}
				});
				return keysArray;
			}

			function collectKeysRecursive(obj, prefix, keysArray, keysSet) {
				if (obj === null || obj === undefined) return;

				if (Array.isArray(obj)) {
					// 找出所有语言中该数组的最大长度
					const maxLen = obj.length;
					for (let i = 0; i < maxLen; i++) {
						const fullKey = prefix ? `${prefix}[${i}]` : `[${i}]`;
						const item = obj[i];
						if (item !== undefined && item !== null && typeof item === 'object') {
							collectKeysRecursive(item, fullKey, keysArray, keysSet);
						} else {
							// 基本类型数组元素
							if (!keysSet.has(fullKey)) {
								keysSet.add(fullKey);
								keysArray.push(fullKey);
							}
						}
					}
				} else if (typeof obj === 'object') {
					Object.keys(obj).forEach(key => {
						const fullKey = prefix ? `${prefix}.${key}` : key;
						const value = obj[key];

						if (value !== null && typeof value === 'object') {
							collectKeysRecursive(value, fullKey, keysArray, keysSet);
						} else {
							// 叶子节点（包括 string, number, boolean）
							if (!keysSet.has(fullKey)) {
								keysSet.add(fullKey);
								keysArray.push(fullKey);
							}
						}
					});
				}
			}

			// 解析路径，支持 a.b[0].c 格式
			function parsePath(path) {
				const parts = [];
				const regex = /([^.\[\]]+)|\[(\d+)\]/g;
				let match;
				while ((match = regex.exec(path)) !== null) {
					if (match[1] !== undefined) {
						parts.push(match[1]);
					} else if (match[2] !== undefined) {
						parts.push(parseInt(match[2], 10));
					}
				}
				return parts;
			}

			function getNestedValue(obj, path) {
				if (!path) return obj;
				const parts = parsePath(path);
				let current = obj;
				for (const part of parts) {
					if (current === null || current === undefined) return undefined;
					current = current[part];
				}
				return current;
			}

			function setNestedValue(obj, path, value) {
				const parts = parsePath(path);
				const lastKey = parts.pop();
				let current = obj;
				for (let i = 0; i < parts.length; i++) {
					const part = parts[i];
					const nextPart = parts[i + 1] !== undefined ? parts[i + 1] : lastKey;
					if (current[part] === undefined || current[part] === null) {
						current[part] = typeof nextPart === 'number' ? [] : {};
					}
					current = current[part];
				}
				current[lastKey] = value;
			}

			function deleteNestedValue(obj, path) {
				const parts = parsePath(path);
				const lastKey = parts.pop();
				let current = obj;
				for (const part of parts) {
					if (current === null || current === undefined) return;
					current = current[part];
				}
				if (current && lastKey in current) {
					if (Array.isArray(current)) {
						current.splice(lastKey, 1);
					} else {
						delete current[lastKey];
					}
				}
			}

			function getFieldCoverage(key) {
				const languages = Object.keys(translations);
				let count = 0;
				languages.forEach(lang => {
					const val = getNestedValue(translations[lang], key);
					if (val !== undefined && val !== null && val !== '') {
						count++;
					}
				});
				return {
					count,
					total: languages.length
				};
			}

			function getFieldStatusClass(key) {
				const {
					count,
					total
				} = getFieldCoverage(key);
				if (count === total) return 'field-complete';
				if (count >= total / 2) return 'field-partial';
				return 'field-missing';
			}

			// 计算字段层级
			function getFieldLevel(path) {
				const parts = parsePath(path);
				return parts.length - 1;
			}

			// 构建树形结构
			function buildTreeStructure() {
				const tree = {};
				allKeys.forEach(key => {
					const parts = parsePath(key);
					let current = tree;
					let pathSoFar = '';

					parts.forEach((part, index) => {
						const isIndex = typeof part === 'number';
						const partStr = isIndex ? `[${part}]` : part;

						if (pathSoFar) {
							pathSoFar += isIndex ? `[${part}]` : `.${part}`;
						} else {
							pathSoFar = partStr;
						}

						if (!current[partStr]) {
							current[partStr] = {
								_children: {},
								_isLeaf: index === parts.length - 1,
								_fullKey: pathSoFar,
								_isIndex: isIndex,
								_level: index
							};
						}
						if (index === parts.length - 1) {
							current[partStr]._isLeaf = true;
						}
						current = current[partStr]._children;
					});
				});
				return tree;
			}

			function renderFieldTree() {
				const tree = buildTreeStructure();
				const container = document.getElementById('treeContent');
				container.innerHTML = renderTreeNode(tree, 0);
			}

			function renderTreeNode(node, level) {
				let html = '';
				Object.keys(node).forEach(key => {
					const item = node[key];
					const {
						count,
						total
					} = getFieldCoverage(item._fullKey);
					const statusClass = item._isLeaf ? getFieldStatusClass(item._fullKey) : '';
					const hasChildren = Object.keys(item._children).length > 0;
					const isIndex = item._isIndex;

					const paddingLeft = level * 16 + 8;

					html += `
          <div class="tree-item ${statusClass}" style="padding-left: ${paddingLeft}px;">
            <div class="flex items-center justify-between py-1.5 pr-2 border-b border-slate-100">
              <div class="flex items-center gap-1 flex-1 min-w-0">
                ${hasChildren ? '<span class="text-slate-400 text-xs">&#9662;</span>' : '<span class="w-3"></span>'}
                <span class="text-sm truncate ${item._isLeaf ? 'text-slate-700' : 'text-slate-500 font-medium'} ${isIndex ? 'array-index px-1 rounded text-xs' : ''}">${key}</span>
                ${item._isLeaf ? `<span class="text-xs text-slate-400 ml-1">(${count}/${total})</span>` : ''}
              </div>
              ${item._isLeaf ? `
                <button onclick="deleteField('${item._fullKey}')" class="px-1.5 py-0.5 text-red-500 hover:bg-red-100 rounded text-xs" title="删除字段">-</button>
              ` : ''}
            </div>
          </div>
        `;

					if (hasChildren) {
						html += renderTreeNode(item._children, level + 1);
					}
				});
				return html;
			}

			function showAddFieldModal() {
				document.getElementById('addFieldModal').classList.remove('hidden');
				document.getElementById('newFieldName').value = '';
				document.getElementById('newFieldName').focus();
			}

			function hideAddFieldModal() {
				document.getElementById('addFieldModal').classList.add('hidden');
			}

			function addNewField() {
				const fieldName = document.getElementById('newFieldName').value.trim();
				if (!fieldName) {
					alert('请输入字段名');
					return;
				}

				if (allKeys.includes(fieldName)) {
					alert('字段已存在');
					return;
				}

				Object.keys(translations).forEach(lang => {
					setNestedValue(translations[lang], fieldName, '');
				});

				allKeys.push(fieldName);
				hideAddFieldModal();
				renderFieldTree();
				renderPanels();
				updatePreview();
			}

			function deleteField(key) {
				if (!confirm(`确定要删除字段 "${key}" 吗？这将从所有语言中移除该字段。`)) {
					return;
				}

				Object.keys(translations).forEach(lang => {
					deleteNestedValue(translations[lang], key);
				});

				allKeys = allKeys.filter(k => k !== key);
				renderFieldTree();
				renderPanels();
				updatePreview();
			}

			function renderPanels() {
				const container = document.getElementById('panels');
				const languages = Object.keys(translations);
				const searchTerm = document.getElementById('searchInput').value.toLowerCase();

				const filteredKeys = searchTerm ?
					allKeys.filter(key => {
						if (key.toLowerCase().includes(searchTerm)) return true;
						return languages.some(lang => {
							const val = getNestedValue(translations[lang], key);
							return val !== undefined && val !== null && String(val).toLowerCase().includes(
								searchTerm);
						});
					}) :
					allKeys;

				container.innerHTML = languages.map(lang => `
        <div class="lang-panel bg-white rounded-lg shadow-sm overflow-hidden flex flex-col" style="max-height: calc(100vh - 280px);">
          <div class="bg-slate-700 text-white px-4 py-2 font-medium text-sm sticky top-0 flex justify-between items-center">
            <span>${lang.toUpperCase()}</span>
            <span class="text-slate-300 text-xs">${filteredKeys.length} 字段</span>
          </div>
          <div class="overflow-y-auto flex-1 scroll-panel" data-scroll-panel="true">
            ${filteredKeys.map(key => {
              const value = getNestedValue(translations[lang], key);
              const level = getFieldLevel(key);
              const marginLeft = level * 12;
              const isEmpty = value === undefined || value === null || value === '';
              const isBool = typeof value === 'boolean';
              const displayKeyParts = getDisplayKeyParts(key);
              
              return `
                <div class="field-row border-b border-slate-100 p-2 ${isEmpty && !isBool ? 'bg-red-50' : ''}" style="margin-left: ${marginLeft}px;">
                  <div class="flex items-center gap-1 mb-1 flex-wrap text-xs">
                    ${displayKeyParts}
                  </div>
                  ${isBool ? `
                    <label class="switch">
                      <input type="checkbox" ${value ? 'checked' : ''} 
                        data-lang="${lang}" 
                        data-key="${key}" 
                        data-type="boolean"
                        onchange="updateBoolValue(this)">
                      <span class="slider"></span>
                    </label>
                    <span class="ml-2 text-xs text-slate-500">${value ? 'true' : 'false'}</span>
                  ` : `
                    <input 
                      type="text" 
                      class="w-full px-2 py-1.5 text-sm border ${isEmpty ? 'border-red-300 bg-red-50' : 'border-slate-200 bg-slate-50'} rounded hover:bg-white focus:bg-white transition"
                      value="${escapeHtml(String(value ?? ''))}"
                      data-lang="${lang}"
                      data-key="${key}"
                      onchange="updateValue(this)"
                    >
                  `}
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `).join('');

				initSyncScroll();
			}

			function escapeHtml(str) {
				return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
			}

			function getDisplayKeyParts(key) {
				const parts = parsePath(key);
				let html = '';
				parts.forEach((part, idx) => {
					const isIndex = typeof part === 'number';
					if (idx > 0 && !isIndex) {
						html += '<span class="text-slate-300">.</span>';
					}
					if (isIndex) {
						html += `<span class="array-index px-1 rounded">[${part}]</span>`;
					} else {
						html +=
							`<span class="${idx === parts.length - 1 ? 'font-medium text-slate-700' : 'text-slate-400'}">${part}</span>`;
					}
				});
				return html;
			}

			function initSyncScroll() {
				const scrollPanels = document.querySelectorAll('.scroll-panel');
				let ticking = false;
				let activePanel = null;
				let targetScrollTop = 0;

				scrollPanels.forEach(panel => {
					panel.addEventListener('scroll', function(e) {
						if (isSyncingScroll) return;

						activePanel = this;
						targetScrollTop = this.scrollTop;

						if (!ticking) {
							requestAnimationFrame(() => {
								if (activePanel) {
									isSyncingScroll = true;

									scrollPanels.forEach(otherPanel => {
										if (otherPanel !== activePanel) {
											otherPanel.scrollTop = targetScrollTop;
										}
									});

									isSyncingScroll = false;
								}
								ticking = false;
							});
							ticking = true;
						}
					}, {
						passive: true
					});
				});
			}

			function updateValue(input) {
				const lang = input.dataset.lang;
				const key = input.dataset.key;
				let value = input.value;

				// 尝试保持原始类型
				const originalValue = getNestedValue(translations[lang], key);
				if (typeof originalValue === 'number') {
					const num = parseFloat(value);
					if (!isNaN(num)) value = num;
				}

				setNestedValue(translations[lang], key, value);
				renderFieldTree();
				updatePreview();
			}

			function updateBoolValue(input) {
				const lang = input.dataset.lang;
				const key = input.dataset.key;
				const value = input.checked;

				setNestedValue(translations[lang], key, value);

				// 更新显示的文字
				const label = input.parentElement.nextElementSibling;
				if (label) {
					label.textContent = value ? 'true' : 'false';
				}

				renderFieldTree();
				updatePreview();
			}

			function filterFields() {
				renderPanels();
			}

			function setQuoteMode(withQuotes) {
				useQuotes = withQuotes;
				document.getElementById('quoteOff').classList.toggle('active', !withQuotes);
				document.getElementById('quoteOn').classList.toggle('active', withQuotes);
				updatePreview();
			}

			function generateOutput() {
				return stringifyObject(translations, 0);
			}

			function stringifyObject(obj, indent) {
				const spaces = '  '.repeat(indent);
				const innerSpaces = '  '.repeat(indent + 1);

				if (Array.isArray(obj)) {
					if (obj.length === 0) return '[]';
					const items = obj.map(item => {
						if (item === null) return `${innerSpaces}null`;
						if (typeof item === 'object') return `${innerSpaces}${stringifyObject(item, indent + 1)}`;
						if (typeof item === 'string') return `${innerSpaces}"${escapeString(item)}"`;
						if (typeof item === 'boolean') return `${innerSpaces}${item}`;
						return `${innerSpaces}${item}`;
					});
					return `[\n${items.join(',\n')}\n${spaces}]`;
				}

				if (typeof obj === 'object' && obj !== null) {
					const keys = Object.keys(obj);
					if (keys.length === 0) return '{}';
					const items = keys.map(key => {
						const value = obj[key];
						const keyStr = useQuotes ? `"${key}"` : key;
						if (value === null) return `${innerSpaces}${keyStr}: null`;
						if (typeof value === 'object')
						return `${innerSpaces}${keyStr}: ${stringifyObject(value, indent + 1)}`;
						if (typeof value === 'string') return `${innerSpaces}${keyStr}: "${escapeString(value)}"`;
						if (typeof value === 'boolean') return `${innerSpaces}${keyStr}: ${value}`;
						return `${innerSpaces}${keyStr}: ${value}`;
					});
					return `{\n${items.join(',\n')}\n${spaces}}`;
				}

				return String(obj);
			}

			function escapeString(str) {
				return str.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '\\r').replace(/\t/g,
					'\\t');
			}

			function updatePreview() {
				const output = generateOutput();
				const prefix = originalFormat === 'js' ? 'translations = ' : '';
				document.getElementById('previewOutput').textContent = prefix + output;
			}

			function copyToClipboard() {
				const output = generateOutput();
				const prefix = originalFormat === 'js' ? 'translations = ' : '';
				navigator.clipboard.writeText(prefix + output).then(() => {
					alert('已复制到剪贴板');
				});
			}

			function downloadJSON() {
				const output = generateOutput();
				const prefix = originalFormat === 'js' ? 'translations = ' : '';
				const blob = new Blob([prefix + output], {
					type: 'application/json'
				});
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = 'translations.json';
				a.click();
				URL.revokeObjectURL(url);
			}

			function copyPreview() {
				const text = document.getElementById('previewOutput').textContent;
				navigator.clipboard.writeText(text).then(() => {
					alert('已复制到剪贴板');
				});
			}

			function downloadPreview() {
				const text = document.getElementById('previewOutput').textContent;
				const blob = new Blob([text], {
					type: 'text/plain'
				});
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = originalFormat === 'js' ? 'translations.js' : 'translations.json';
				a.click();
				URL.revokeObjectURL(url);
			}
		</script>
	</body>
</html>