<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>DeepSeek Chat</title>
		<style>
			/* åŸºç¡€æ ·å¼ï¼ˆæ¨¡ä»¿ ChatGPT é£æ ¼ï¼‰ */
			body {
				margin: 0;
				padding: 0;
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
				background-color: #f7f7f7;
			}

			.container {
				display: flex;
				height: 100vh;
				overflow: hidden;
			}

			/* å·¦ä¾§è¾¹æ  */
			#sidebar {
				width: 260px;
				background-color: #f1f1f1;
				border-right: 1px solid #ddd;
				padding: 16px;
				display: flex;
				flex-direction: column;
				overflow-y: auto;
				transition: transform 0.3s ease;
			}

			#sidebar-header {
				margin-bottom: 16px;
			}

			#sidebar-header h1 {
				font-size: 1.5em;
				margin: 0;
				padding: 0;
			}

			#new-chat-btn {
				width: 100%;
				padding: 10px;
				margin-bottom: 16px;
				background-color: #10a37f;
				color: #fff;
				border: none;
				border-radius: 4px;
				cursor: pointer;
			}

			/* å†å²å¯¹è¯åˆ—è¡¨ */
			#history {
				flex: 1;
				margin-bottom: 16px;
			}

			.history-item {
				padding: 8px;
				margin-bottom: 8px;
				background-color: #fff;
				border-radius: 4px;
				cursor: pointer;
				border: 1px solid transparent;
			}

			.history-item:hover {
				border: 1px solid #ddd;
			}

			/* è®¾ç½®åŒºåŸŸ */
			#settings {
				border-top: 1px solid #ddd;
				padding-top: 16px;
			}

			#settings h3 {
				font-size: 1.2em;
				margin-bottom: 8px;
			}

			#settings input,
			#settings select {
				width: 100%;
				padding: 8px;
				margin-bottom: 8px;
				border: 1px solid #ddd;
				border-radius: 4px;
				box-sizing: border-box;
			}

			#settings button {
				width: 100%;
				padding: 8px;
				background-color: #007bff;
				color: #fff;
				border: none;
				border-radius: 4px;
				cursor: pointer;
				margin-bottom: 4px;
			}

			#settings button:hover {
				background-color: #0069d9;
			}

			#settings-status {
				margin-top: 8px;
				font-size: 0.9em;
				color: red;
			}

			/* ä½™é¢åŒºåŸŸ */
			#balance-section {
				margin-top: 8px;
				font-size: 0.9em;
				color: #333;
			}

			/* å³ä¾§èŠå¤©åŒº */
			#chat-area {
				flex: 1;
				display: flex;
				flex-direction: column;
				background-color: #fff;
				overflow: hidden;
				position: relative;
			}

			#chat-messages {
				flex: 1;
				padding: 16px;
				overflow-y: auto;
				background-color: #f7f7f7;
			}

			.message {
				margin-bottom: 12px;
				padding: 8px 12px;
				border-radius: 6px;
				max-width: 70%;
				width: fit-content;
				word-wrap: break-word;
			}

			.user-message {
				background-color: #dcf8c6;
				align-self: flex-end;
			}

			.api-message {
				background-color: #f1f0f0;
				align-self: flex-start;
			}

			#chat-input-container {
				display: flex;
				padding: 16px;
				border-top: 1px solid #ddd;
			}

			#chat-input {
				flex: 1;
				padding: 12px;
				border: 1px solid #ddd;
				border-radius: 4px;
				font-size: 1em;
				box-sizing: border-box;
			}

			#send-btn {
				padding: 12px 20px;
				margin-left: 8px;
				background-color: #10a37f;
				color: #fff;
				border: none;
				border-radius: 4px;
				cursor: pointer;
			}

			/* ç§»åŠ¨ç«¯æ ·å¼ */
			/* å±å¹•å®½åº¦å°äº768pxæ—¶ï¼Œé‡‡ç”¨å‚ç›´å¸ƒå±€ï¼Œå¹¶éšè—ä¾§è¾¹æ ï¼ˆå¯é€šè¿‡â€œæ±‰å ¡èœå•â€åˆ‡æ¢æ˜¾ç¤ºï¼‰ */
			@media (max-width: 768px) {
				.container {
					flex-direction: column;
				}

				#sidebar {
					position: fixed;
					top: 0;
					left: 0;
					height: 100%;
					z-index: 100;
					transform: translateX(-100%);
					width: 80%;
					max-width: 300px;
				}

				#sidebar.active {
					transform: translateX(0);
				}

				#chat-area {
					flex: 1;
					margin-top: 0;
				}

				/* æ˜¾ç¤ºåˆ‡æ¢ä¾§è¾¹æ çš„æ±‰å ¡èœå•æŒ‰é’® */
				#toggle-sidebar {
					display: block;
					position: fixed;
					top: 10px;
					left: 10px;
					z-index: 200;
					background: #10a37f;
					color: #fff;
					border: none;
					border-radius: 4px;
					padding: 8px;
					cursor: pointer;
				}

				/* é˜²æ­¢æ±‰å ¡èœå•é®æŒ¡èŠå¤©è¾“å…¥åŒºåŸŸ */
				#chat-area {
					padding-top: 50px;
				}
			}

			/* å®½å±ä¸‹éšè—æ±‰å ¡èœå•æŒ‰é’® */
			@media (min-width: 769px) {
				#toggle-sidebar {
					display: none;
				}

				#sidebar {
					transform: translateX(0);
					position: relative;
				}
			}

			.message-container {
				position: relative;
				margin-bottom: 12px;
			}

			.model-badge {
				position: absolute;
				right: 0;
				bottom: 0;
				background-color: #007bff;
				color: white;
				padding: 4px 8px;
				font-size: 0.8em;
				border-radius: 4px;
			}

			details {
				margin-top: 8px;
				padding: 8px;
				background-color: #f9f9f9;
				border-radius: 4px;
			}

			summary {
				font-weight: bold;
			}
		</style>
	</head>
	<body>
		<button id="toggle-sidebar">â˜°</button>

		<div class="container">
			<div id="sidebar">
				<div id="sidebar-header">
					<h1>DeepSeek Chat</h1>
				</div>
				<button id="new-chat-btn">+ æ–°å¯¹è¯</button>
				<div id="history"></div>
				<div id="settings">
					<h3>è®¾ç½®</h3>
					<input type="text" id="apiKey" placeholder="API Key" />
					<select id="modelSelect">
						<option value="deepseek-chat">deepseek-chat (DeepSeek-V3)</option>
						<option value="deepseek-reasoner">deepseek-reasoner (DeepSeek-R1)</option>
					</select>
					<button id="save-settings">ä¿å­˜è®¾ç½®</button>
					<button id="check-balance">æŸ¥è¯¢ä½™é¢</button>
					<div id="settings-status"></div>
					<div id="balance-section"></div>
				</div>
			</div>

			<div id="chat-area">
				<div id="chat-messages"></div>
				<div id="chat-input-container">
					<input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." />
					<button id="send-btn">å‘é€</button>
				</div>
			</div>
		</div>

		<script>
			/***********************
			 * å¸¸é‡ä¸é¡µé¢å…ƒç´ è·å–
			 ***********************/
			const LS_API_KEY = 'ds_api_key';
			const LS_MODEL = 'ds_model';

			const apiKeyInput = document.getElementById('apiKey');
			const modelSelect = document.getElementById('modelSelect');
			const saveSettingsBtn = document.getElementById('save-settings');
			const checkBalanceBtn = document.getElementById('check-balance');
			const settingsStatus = document.getElementById('settings-status');
			const balanceSection = document.getElementById('balance-section');
			const chatMessagesDiv = document.getElementById('chat-messages');
			const chatInput = document.getElementById('chat-input');
			const sendBtn = document.getElementById('send-btn');
			const toggleSidebarBtn = document.getElementById('toggle-sidebar');
			const sidebar = document.getElementById('sidebar');
			const historyDiv = document.getElementById('history');

			/***********************
			 * ç›‘å¬æ¨¡å‹é€‰é¡¹å˜åŒ–ï¼Œå­˜å…¥ localStorage
			 ***********************/
			window.addEventListener('DOMContentLoaded', (event) => {
				const modelSelect = document.getElementById("modelSelect");

				// è·å–å½“å‰é€‰æ‹©çš„å€¼
				const selectedModel = modelSelect.value;

				// å­˜å‚¨åˆ° localStorage
				localStorage.setItem('LS_MODEL', selectedModel);

				// æ‰“å°ä»¥ç¡®è®¤å­˜å‚¨
				console.log("å·²å­˜å‚¨çš„æ¨¡å‹:", selectedModel);
			});


			modelSelect.addEventListener('change', function() {
				localStorage.setItem(LS_MODEL, modelSelect.value);
				console.log("æ¨¡å‹é€‰æ‹©æ›´æ–°ä¸º:", modelSelect.value);
			});

			/***********************
			 * å¯¹è¯ç®¡ç†ç›¸å…³å˜é‡ä¸å‡½æ•°
			 ***********************/
			let currentConversation = null; // å½“å‰æ­£åœ¨è¿›è¡Œçš„å¯¹è¯å¯¹è±¡
			// å¯¹è¯å¯¹è±¡ç»“æ„ï¼š
			// {
			//   id: æ—¶é—´æˆ³æ•°å­—,
			//   messages: [ { role: 'user' | 'assistant', content: string, timestamp: number } ]
			// }

			// ä¿å­˜å½“å‰å¯¹è¯åˆ° localStorage
			function saveCurrentConversation() {
				if (currentConversation) {
					localStorage.setItem('conversation_' + currentConversation.id, JSON.stringify(currentConversation));
					console.log('å¯¹è¯å·²ä¿å­˜ï¼Œid:', currentConversation.id);
				}
			}

			// å°†æŸä¸ªå¯¹è¯æ·»åŠ åˆ°å†å²å¯¹è¯åˆ—è¡¨ä¸­
			function addConversationToHistory(convo) {
				// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰
				if (document.getElementById('convo-' + convo.id)) return;

				const convoItem = document.createElement('div');
				convoItem.classList.add('history-item');
				convoItem.id = 'convo-' + convo.id;
				// æ˜¾ç¤ºç®€å•çš„æ—¶é—´æˆ³æˆ–è‡ªå®šä¹‰åç§°
				convoItem.textContent = 'å¯¹è¯ ' + new Date(convo.id).toLocaleString();
				convoItem.addEventListener('click', () => {
					console.log('åˆ‡æ¢åˆ°å¯¹è¯ï¼š', convo.id);
					switchConversation(convo);
				});
				historyDiv.appendChild(convoItem);
			}

			// åŠ è½½ localStorage ä¸­æ‰€æœ‰å¯¹è¯å¹¶æ˜¾ç¤ºåœ¨å†å²åˆ—è¡¨
			function loadConversationList() {
				historyDiv.innerHTML = ''; // å…ˆæ¸…ç©ºå†å²åˆ—è¡¨
				for (let i = 0; i < localStorage.length; i++) {
					const key = localStorage.key(i);
					if (key.startsWith('conversation_')) {
						try {
							const convo = JSON.parse(localStorage.getItem(key));
							addConversationToHistory(convo);
						} catch (e) {
							console.error('åŠ è½½å¯¹è¯å¤±è´¥ï¼Œkey:', key, e);
						}
					}
				}
			}

			// åˆ‡æ¢å¯¹è¯æ—¶ï¼Œæ›´æ–° currentConversation å¹¶æ˜¾ç¤ºè¯¥å¯¹è¯çš„æ‰€æœ‰æ¶ˆæ¯
			function switchConversation(convo) {
				currentConversation = convo;
				console.log('å½“å‰å¯¹è¯å·²åˆ‡æ¢ä¸ºï¼š', currentConversation.id);
				chatMessagesDiv.innerHTML = ''; // æ¸…ç©ºèŠå¤©æ˜¾ç¤ºåŒºåŸŸ
				currentConversation.messages.forEach(msg => {
					// å†å²æ¶ˆæ¯ä»…æ˜¾ç¤ºæ¶ˆæ¯ï¼Œä¸é™„åŠ æ¨¡å‹è§’æ ‡
					addMessage(msg.role, msg.content);
				});
			}

			/***********************
			 * è®¾ç½®åŒºåŸŸï¼šä¿å­˜ API Keyã€æ¨¡å‹é€‰æ‹©å¹¶éªŒè¯
			 ***********************/
			saveSettingsBtn.addEventListener('click', () => {
				const key = apiKeyInput.value.trim();
				const model = modelSelect.value;
				if (!key) {
					settingsStatus.textContent = "è¯·å¡«å†™ API Key";
					return;
				}
				localStorage.setItem(LS_API_KEY, key);
				localStorage.setItem(LS_MODEL, model);
				settingsStatus.style.color = 'green';
				//settingsStatus.textContent = "è®¾ç½®å·²ä¿å­˜";
				console.log('è®¾ç½®å·²ä¿å­˜ï¼ŒAPI Key:', key, 'æ¨¡å‹:', model);
				verifyApiKey(key, model);
			});

			// æ ¹æ®æ¨¡å‹ç±»å‹è°ƒç”¨ä¸åŒçš„ API Key éªŒè¯å‡½æ•°
			function verifyApiKey(key, model) {
				if (model === "deepseek-chat") {
					verifyApiKeyV3(key);
				} else if (model === "deepseek-reasoner") {
					verifyApiKeyR1(key);
				} else {
					console.error("æœªçŸ¥çš„æ¨¡å‹ç±»å‹ï¼š", model);
				}
			}

			// DeepSeek-V3 API Key éªŒè¯å‡½æ•°
			async function verifyApiKeyV3(key) {
				settingsStatus.style.color = '#333';
				settingsStatus.textContent = "æ­£åœ¨éªŒè¯ API Key (V3)ï¼Œè¯·ç¨å€™...";
				console.log("å¼€å§‹éªŒè¯ API Key (V3)ï¼š", key);
				try {
					const url = "https://api.deepseek.com/chat/completions";
					const response = await fetch(url, {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							'Authorization': 'Bearer ' + key
						},
						body: JSON.stringify({
							model: "deepseek-chat",
							messages: [{
								role: 'system',
								content: 'æµ‹è¯•æ¶ˆæ¯'
							}],
							max_tokens: 50,
							temperature: 1,
							top_p: 1,
							frequency_penalty: 0,
							presence_penalty: 0,
							stream: false
						})
					});
					const data = await response.json();
					console.log("V3 API Key éªŒè¯è¿”å›æ•°æ®ï¼š", data);
					if (data.error) {
						settingsStatus.style.color = 'red';
						settingsStatus.textContent = "éªŒè¯å¤±è´¥ (V3): " + data.error.message;
					} else {
						settingsStatus.style.color = 'green';
						settingsStatus.textContent = "éªŒè¯æˆåŠŸ (V3)";
					}
				} catch (error) {
					settingsStatus.style.color = 'red';
					settingsStatus.textContent = "éªŒè¯å¤±è´¥ (V3): " + error.message;
					console.error("éªŒè¯ API Key (V3) è¿‡ç¨‹ä¸­å‡ºé”™ï¼š", error);
				}
			}

			// DeepSeek-R1 API Key éªŒè¯å‡½æ•°
			async function verifyApiKeyR1(key) {
				const url = "https://api.deepseek.com/chat/completions"; // ä¿®æ­£ base_url
				console.log('DeepSeek-R1 è¯·æ±‚ URL:', url);

				try {
					const response = await fetch(url, {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							'Authorization': 'Bearer ' + key // ä½¿ç”¨ä¼ å…¥çš„ API Key
						},
						body: JSON.stringify({
							model: 'deepseek-reasoner', // ä½¿ç”¨ deepseek-reasoner æ¨¡å‹è¿›è¡ŒéªŒè¯
							messages: [{
									role: 'system',
									content: "You are a helpful assistant"
								},
								{
									role: 'user',
									content: "æµ‹è¯•æ¶ˆæ¯"
								}
							],
							max_tokens: 50,
							temperature: 1,
							top_p: 1,
							frequency_penalty: 0,
							presence_penalty: 0,
							stream: false // å…³é—­æµå¼
						})
					});

					// ** å…ˆè·å–è¿”å›å†…å®¹ï¼Œä¸ç›´æ¥è§£æ JSON **
					const responseText = await response.text();
					console.log("æœåŠ¡å™¨è¿”å›çš„åŸå§‹å†…å®¹:", responseText);

					// ** å¤„ç†æœåŠ¡å™¨è¿”å›ç©ºå€¼çš„æƒ…å†µ **
					if (!response.ok) {
						throw new Error(`HTTP error ${response.status}: ${responseText || "æœåŠ¡å™¨æœªè¿”å›æ•°æ®"}`);
					}

					// ** ç¡®ä¿ responseText ä¸æ˜¯ç©ºçš„ **
					if (!responseText) {
						throw new Error("æœåŠ¡å™¨è¿”å›ä¸ºç©ºï¼Œæ— æ³•è§£æ JSON");
					}

					// ** è§£æ JSON **
					const data = JSON.parse(responseText);
					console.log('DeepSeek-R1 éªŒè¯è¿”å›æ•°æ®ï¼š', data);

					// ** æ£€æŸ¥ API æ˜¯å¦è¿”å›é”™è¯¯ä¿¡æ¯ **
					if (data.error) {
						console.error("éªŒè¯å¤±è´¥ï¼š", data.error.message);
						settingsStatus.style.color = 'red';
						settingsStatus.textContent = "éªŒè¯å¤±è´¥ (R1): " + data.error.message;
					} else {
						console.log("éªŒè¯æˆåŠŸï¼š", data);
						settingsStatus.style.color = 'green';
						settingsStatus.textContent = "éªŒè¯æˆåŠŸ (R1)";
					}
				} catch (error) {
					console.error("éªŒè¯ API Key (R1) è¿‡ç¨‹ä¸­å‡ºé”™ï¼š", error);
					settingsStatus.style.color = 'red';
					settingsStatus.textContent = "éªŒè¯å¤±è´¥ (R1): " + error.message;
				}
			}



			/***********************
			 * ä½™é¢æŸ¥è¯¢åŠŸèƒ½
			 ***********************/
			checkBalanceBtn.addEventListener('click', checkBalance);
			async function checkBalance() {
				const key = localStorage.getItem(LS_API_KEY);
				if (!key) {
					balanceSection.textContent = "è¯·å…ˆè®¾ç½® API Key";
					return;
				}
				balanceSection.textContent = "æ­£åœ¨æŸ¥è¯¢ä½™é¢...";
				console.log('å¼€å§‹æŸ¥è¯¢ä½™é¢ï¼ŒAPI Key:', key);
				try {
					const response = await fetch('https://api.deepseek.com/user/balance', {
						method: 'GET',
						headers: {
							'Accept': 'application/json',
							'Authorization': 'Bearer ' + key
						}
					});
					const data = await response.json();
					console.log('ä½™é¢æŸ¥è¯¢è¿”å›æ•°æ®ï¼š', data);
					if (data && data.balance_infos && data.balance_infos.length > 0) {
						const balance = parseFloat(data.balance_infos[0].granted_balance);
						const formattedBalance = balance + "å…ƒ";
						balanceSection.textContent = "ä½™é¢è¯¦æƒ…: " + formattedBalance;
					} else {
						balanceSection.textContent = "æ— æ³•è·å–ä½™é¢ä¿¡æ¯";
					}
				} catch (error) {
					balanceSection.textContent = "æŸ¥è¯¢ä½™é¢å¤±è´¥: " + error.message;
					console.error('æŸ¥è¯¢ä½™é¢å‡ºé”™ï¼š', error);
				}
			}

			/***********************
			 * è¾…åŠ©å‡½æ•°ï¼šåœ¨èŠå¤©åŒºåŸŸä¸­æ·»åŠ æ¶ˆæ¯
			 * role: 'user' æˆ– 'api'
			 * badgeTextï¼šå½“ role==='api' æ—¶ï¼Œæ ¹æ®è¿”å›æ¨¡å‹æ˜¾ç¤ºè§’æ ‡
			 ***********************/
			function addMessage(role, content, badgeText) {
				const messageContainer = document.createElement('div');
				messageContainer.classList.add('message-container');

				const msgDiv = document.createElement('div');
				msgDiv.classList.add('message', role === 'user' ? 'user-message' : 'api-message');
				msgDiv.textContent = content;
				messageContainer.appendChild(msgDiv);

				if (role === 'api' && badgeText) {
					const modelBadge = document.createElement('span');
					modelBadge.classList.add('model-badge');
					modelBadge.textContent = badgeText;
					messageContainer.appendChild(modelBadge);
				}
				chatMessagesDiv.appendChild(messageContainer);
				chatMessagesDiv.scrollTop = chatMessagesDiv.scrollHeight;
			}

			/***********************
			 * èŠå¤©é€»è¾‘ï¼šæ ¹æ®é€‰æ‹©æ¡†åˆ†ä¸º v3 ä¸ r1 ä¸¤ä¸ªå‘é€å‡½æ•°
			 * æ¯æ¬¡å‘é€æ¶ˆæ¯å‰ä» localStorage è¯»å–å½“å‰è®¾ç½®
			 ***********************/
			sendBtn.addEventListener('click', sendChat);
			chatInput.addEventListener('keydown', (e) => {
				if (e.key === 'Enter') {
					sendChat();
				}
			});

			function sendChat() {
				const messageText = chatInput.value.trim();
				if (!messageText) return;
				console.log('ç”¨æˆ·å‘é€æ¶ˆæ¯:', messageText);

				// å¦‚æœå½“å‰æ²¡æœ‰å¯¹è¯ï¼Œåˆ™åˆ›å»ºæ–°çš„å¯¹è¯å¹¶æ·»åŠ åˆ°å†å²è®°å½•ä¸­
				if (!currentConversation) {
					currentConversation = {
						id: Date.now(),
						messages: []
					};
					console.log('åˆ›å»ºæ–°å¯¹è¯ï¼Œid:', currentConversation.id);
					addConversationToHistory(currentConversation);
				}

				// ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ°å½“å‰å¯¹è¯
				const userMsgObj = {
					role: 'user',
					content: messageText,
					timestamp: Date.now()
				};
				currentConversation.messages.push(userMsgObj);
				saveCurrentConversation();

				// æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
				addMessage('user', messageText);
				chatInput.value = "";

				// æ¯æ¬¡å‘é€æ—¶ï¼Œä» localStorage è¯»å–å½“å‰è®¾ç½®
				const apiKey = localStorage.getItem(LS_API_KEY);
				const model = localStorage.getItem(LS_MODEL) || modelSelect.value;
				console.log('å½“å‰ API Key:', apiKey, 'å½“å‰æ¨¡å‹:', model);
				if (!apiKey) {
					alert("è¯·å…ˆåœ¨è®¾ç½®ä¸­ä¿å­˜ API Key");
					return;
				}

				// æ ¹æ®æ¨¡å‹åˆ†æ”¯è°ƒç”¨ä¸åŒçš„å‘é€å‡½æ•°
				if (model === "deepseek-chat") {
					console.log('è°ƒç”¨ DeepSeek-V3 æ¥å£');
					sendMessageV3(apiKey, model, messageText);
				} else if (model === "deepseek-reasoner") {
					console.log('è°ƒç”¨ DeepSeek-R1 æ¥å£');
					sendMessageR1(apiKey, model, messageText);
				} else {
					console.error('æœªçŸ¥çš„æ¨¡å‹ç±»å‹:', model);
				}
			}

			// DeepSeek-V3 æ¶ˆæ¯å‘é€å‡½æ•°ï¼ˆéæµå¼å›å¤ï¼‰
			async function sendMessageV3(apiKey, model, messageText) {
				const url = "https://api.deepseek.com/chat/completions";
				console.log('DeepSeek-V3 è¯·æ±‚ URL:', url);
				try {
					const response = await fetch(url, {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							'Authorization': 'Bearer ' + apiKey
						},
						body: JSON.stringify({
							model: model,
							messages: [{
								role: 'user',
								content: messageText
							}],
							max_tokens: 2048,
							temperature: 1,
							top_p: 1,
							frequency_penalty: 0,
							presence_penalty: 0,
							stream: false // å…³é—­æµå¼
						})
					});
					if (!response.ok) {
						throw new Error("HTTP error " + response.status);
					}
					const data = await response.json();
					console.log('DeepSeek-V3 è¿”å›æ•°æ®ï¼š', data);
					let resultText = "";
					if (data && data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message
						.content) {
						resultText = data.choices[0].message.content;
					} else {
						resultText = "æ²¡æœ‰æ”¶åˆ°æœ‰æ•ˆå›å¤ã€‚";
					}

					// æ ¹æ®è¿”å› JSON ä¸­çš„ model å­—æ®µæ¥ç¡®å®šè§’æ ‡
					let badgeText = "";
					if (data.model === "deepseek-chat") {
						badgeText = "DeepSeek-V3";
					} else if (data.model === "deepseek-reasoner") {
						badgeText = "DeepSeek-R1";
					}
					console.log('DeepSeek-V3 å›å¤æ¶ˆæ¯:', resultText, 'è§’æ ‡:', badgeText);

					// ä¿å­˜å›å¤æ¶ˆæ¯åˆ°å½“å‰å¯¹è¯ä¸­
					const botMsgObj = {
						role: 'assistant',
						content: resultText,
						timestamp: Date.now()
					};
					currentConversation.messages.push(botMsgObj);
					saveCurrentConversation();

					// æ˜¾ç¤ºå›å¤æ¶ˆæ¯åŠè§’æ ‡
					addMessage('api', resultText, badgeText);
				} catch (error) {
					console.error('DeepSeek-V3 è¯·æ±‚å‡ºé”™ï¼š', error);
					addMessage('api', "é”™è¯¯: " + error.message, "");
				}
			}

			// DeepSeek-R1 æ¶ˆæ¯å‘é€å‡½æ•°ï¼ˆéæµå¼å›å¤ï¼‰
			async function sendMessageR1(apiKey, model, messageText) {
					const url = "https://api.deepseek.com/v1/chat/completions"; // ä¿®æ­£ base_url
					console.log('DeepSeek-R1 è¯·æ±‚ URL:', url, 'Model:', model);

					try {
						const response = await fetch(url, {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
								'Authorization': 'Bearer ' + apiKey // ç¡®ä¿ API Key æ­£ç¡®
							},
							body: JSON.stringify({
								model: 'deepseek-reasoner', // è¿™é‡Œç¡®ä¿ä¼ å…¥ deepseek-reasoner
								messages: [{
										role: 'system',
										content: "You are a helpful assistant"
									}, // system è§’è‰²å†…å®¹ä¸èƒ½æ˜¯ç©ºå­—ç¬¦ä¸²
									{
										role: 'user',
										content: messageText
									}
								],
								max_tokens: 2048,
								temperature: 1,
								top_p: 1,
								frequency_penalty: 0,
								presence_penalty: 0,
								stream: false // å…³é—­æµå¼
							})
						});

						// **ğŸ”¹ æ‰“å° HTTP çŠ¶æ€ç  ğŸ”¹**
						console.log('HTTP çŠ¶æ€ç : ${response.status}');

							// **ğŸ”¹ å…ˆè·å–è¿”å›çš„ headers ğŸ”¹**
							console.log('æœåŠ¡å™¨è¿”å›çš„ Headers:', response.headers);

							// **ğŸ”¹ å…ˆè·å–è¿”å›çš„åŸå§‹æ–‡æœ¬ ğŸ”¹**
							const responseText = await response.text(); console.log("æœåŠ¡å™¨è¿”å›çš„åŸå§‹å†…å®¹:", responseText);

							// **ğŸ”¹ å¦‚æœ HTTP çŠ¶æ€ç ä¸æ˜¯ 2xxï¼ŒæŠ›å‡ºé”™è¯¯ ğŸ”¹**
							if (!response.ok) {
								throw new Error('HTTP error ${response.status}: ${responseText || "æœåŠ¡å™¨æœªè¿”å›æ•°æ®"}');
							}

							// **ğŸ”¹ å¦‚æœè¿”å›å†…å®¹ä¸ºç©ºï¼Œæç¤ºå¯èƒ½çš„åŸå›  ğŸ”¹**
							if (!responseText) {
								throw new Error("æœåŠ¡å™¨è¿”å›ä¸ºç©ºï¼Œå¯èƒ½ API Key æ— æ•ˆã€ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨é™æµ");
							}

							// **ğŸ”¹ è§£æ JSON ğŸ”¹**
							const data = JSON.parse(responseText); console.log('DeepSeek-R1 è¿”å›æ•°æ®ï¼š', data);

							let resultText = "";
							if (data && data.choices && data.choices[0] && data.choices[0].message && data.choices[0].message
								.content) {
								resultText = data.choices[0].message.content;
							} else {
								resultText = "æ²¡æœ‰æ”¶åˆ°æœ‰æ•ˆå›å¤ã€‚";
							}

							let badgeText = "";
							if (data.model === "deepseek-chat") {
								badgeText = "DeepSeek-V3";
							} else if (data.model === "deepseek-reasoner") {
								badgeText = "DeepSeek-R1";
							}

							console.log('DeepSeek-R1 å›å¤æ¶ˆæ¯:', resultText, 'è§’æ ‡:', badgeText);

							const botMsgObj = {
								role: 'assistant',
								content: resultText,
								timestamp: Date.now()
							}; currentConversation.messages.push(botMsgObj); saveCurrentConversation();

							addMessage('api', resultText, badgeText);
						}
						catch (error) {
							console.error("DeepSeek-R1 è¯·æ±‚å‡ºé”™ï¼š", error);
							addMessage('api', "é”™è¯¯: " + error.message, "");
						}
					}



					/***********************
					 * ç§»åŠ¨ç«¯ï¼šä¾§è¾¹æ åˆ‡æ¢
					 ***********************/
					toggleSidebarBtn.addEventListener('click', () => {
						sidebar.classList.toggle('active');
						console.log('åˆ‡æ¢ä¾§è¾¹æ æ˜¾ç¤ºçŠ¶æ€');
					});

					/***********************
					 * åˆå§‹åŒ–åŠ è½½å†å²å¯¹è¯åˆ—è¡¨
					 ***********************/
					loadConversationList();
					console.log('å†å²å¯¹è¯åˆ—è¡¨åŠ è½½å®Œæˆ');
		</script>
		<script src="https://cdn.jsdelivr.net/npm/openai"></script>

	</body>
</html>